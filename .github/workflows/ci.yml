name: CI

on:
  push: 

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v1
      with:
        node-version: '10.x'
    - name: setup for truffle 
      run: |
         mkdir ~/.npm-global
         npm config set prefix '~/.npm-global'
         export PATH=~/.npm-global/bin:$PATH
         source ~/.profile
    - name: Global install truffle
      run: | 
         npm install -g truffle
         npm install -g ethereumjs-testrpc
    - name: move node modules
      run: node_modules/.bin/ganache-cli --gasLimit 10000000 > /dev/null & sleep 5
    - name: prep build
      run: rm -rf build
    - name: compile
      run: truffle compile
    - name: migrate
      run: truffle migrate --reset --network development
    - name: test
      run: truffle test
